CREATE DATABASE IF NOT EXISTS Payments;
use Payments;
CREATE TABLE IF NOT EXISTS CLIENT
(
CLIENT_ID BIGINT(10) PRIMARY KEY NOT NULL AUTO_INCREMENT,
FIRST_NAME VARCHAR(20) NOT NULL,
LAST_NAME VARCHAR (20) NOT NULL,
ADDRESS VARCHAR(100) NOT NULL,
DATE_OF_BIRTH DATE,
PHONE_NUMBER VARCHAR (13) NOT NULL,
LOGIN VARCHAR(20) DEFAULT 'USER' NOT NULL,
PASSWORD VARCHAR(20) DEFAULT '12345678' NOT NULL
);
CREATE UNIQUE INDEX CLIENT_LOGIN_uindex ON CLIENT(LOGIN);

CREATE TABLE IF NOT EXISTS CREDIT_CARD
(
CARD_NUMBER BIGINT(16) PRIMARY KEY NOT NULL,
CARD_COMPANY VARCHAR(10) DEFAULT 'NONE' NOT NULL,
FIRST_NAME VARCHAR(20) NOT NULL,
LAST_NAME VARCHAR (20) NOT NULL,
EXP_DATE VARCHAR(5) NOT NULL,
CVV INT(3) NOT NULL,
PIN INT(4) DEFAULT 1111,
BANK_ACCOUNT VARCHAR(28) NOT NULL,
CASHBACK INT(2) DEFAULT 0,
STATUS SET('ACTIVE','DISABLED') DEFAULT 'ACTIVE',
CLIENT_ID BIGINT(10) NOT NULL
);

CREATE TABLE IF NOT EXISTS BANK
(
ACCOUNT_ID BIGINT(16) PRIMARY KEY NOT NULL AUTO_INCREMENT,
BANK_ACCOUNT VARCHAR(28) NOT NULL ,
CLIENT_ID BIGINT(10) NOT NULL,
BALANCE DOUBLE DEFAULT 0 NOT NULL
);

CREATE TABLE IF NOT EXISTS PAYMENT_TRANSACTION
(
TRANSACTION_ID BIGINT(16) PRIMARY KEY AUTO_INCREMENT,
CARD_NUMBER BIGINT(16) NOT NULL,
ACCOUNT_ID BIGINT(16) NOT NULL,
TRANSACTION_TYPE SET('DEPOSIT','WITHDRAW') NOT NULL,
MONEY_AMOUNT DOUBLE  NOT NULL
);

/*ALTER TABLE CLIENT
ADD CONSTRAINT CARD_NUMBER_FK
FOREIGN KEY (CARD_NUMBER) REFERENCES CREDIT_CARD(CARD_NUMBER);

ALTER TABLE CREDIT_CARD
ADD CONSTRAINT BANK_ACCOUNT_FK
FOREIGN KEY (ACCOUNT_ID) REFERENCES BANK(ACCOUNT_ID);*/

ALTER TABLE CREDIT_CARD
ADD CONSTRAINT CARD_CLIENT_ID_FK
FOREIGN KEY(CLIENT_ID) REFERENCES CLIENT(CLIENT_ID) ON DELETE CASCADE;

ALTER TABLE BANK
ADD CONSTRAINT BANK_CLIENT_ID_FK
FOREIGN KEY(CLIENT_ID) REFERENCES CLIENT(CLIENT_ID) ON DELETE CASCADE;

-- ALTER TABLE BANK
-- ADD CONSTRAINT BANK_CARD_NUMBER_FK
-- FOREIGN KEY(CARD_NUMBER) REFERENCES CREDIT_CARD(CARD_NUMBER) ON DELETE CASCADE;

ALTER TABLE PAYMENT_TRANSACTION
ADD CONSTRAINT TRANSACTION_CARD_NUMBER_FK
FOREIGN KEY(CARD_NUMBER) REFERENCES CREDIT_CARD(CARD_NUMBER) ON DELETE CASCADE;

ALTER TABLE PAYMENT_TRANSACTION
ADD CONSTRAINT TRANSACTION_BANK_ACCOUNT_FK
FOREIGN KEY(ACCOUNT_ID) REFERENCES BANK(ACCOUNT_ID) ON DELETE CASCADE;

INSERT  INTO CLIENT (FIRST_NAME,LAST_NAME, ADDRESS,DATE_OF_BIRTH,PHONE_NUMBER,LOGIN,PASSWORD) VALUES
('Alex','Gorodok','Myasnikova 16-115','1976-12-01','+375293429008','Lexxxa22','passFGH32q'),
('Michael','Mukaltin','Kajovskay 21-83','1972-07-25','+375254567809','loopSo','M87jsdR15'),
('Anatolii','Jukovskii','Shevchenko 1-55','1985-02-09','+375447548091','tolik85','OMGsysOK'),
('Gregor','Zgurski','Levkova 11-119','1987-08-24','+375293062555','zgurik','money77'),
('Denis','Zuba','Avakyana 19-31','1989-03-12','+375297894421','zuba','fg354nmLOL');

INSERT INTO CREDIT_CARD (CARD_NUMBER,CARD_COMPANY,FIRST_NAME,LAST_NAME,EXP_DATE,CVV,PIN,BANK_ACCOUNT,CASHBACK,STATUS,CLIENT_ID) VALUES
(5343678223196505,'MasterCard','Gregor','Zgurski','02/21',327,4324,'BY78324JH542OM723MNDF91234LK',3,'ACTIVE',4),
(4567124598526401,'VISA','Alex','Gorodok','09/18',762,4444,'BY22344GF9021K0900MB62264GB1',5,'ACTIVE',1),
(5325876309007422,'MasterCard','Alex','Gorodok','11/24',011,8585,'BY22344GF9021K0900MB62264GB1',10,'ACTIVE',1),
(4110559275236328,'VISA','Denis','Zuba','05/25',899,1717,'BY723KJ9873MN20001ZPL777MBV8',7,'ACTIVE',5),
(5431230964501124,'MasterCard','Michael','Mukaltin','01/22',421,5753,'BY4380H0512GBD345166M9113NC2',3,'ACTIVE',2),
(4545900922113377,'VISA','Anatolii','Jukovskii','04/24',553,0108,'BY0103T77530NX7425BCD66839L9',4,'DISABLED',3);

INSERT INTO BANK(BANK_ACCOUNT,CLIENT_ID,BALANCE) VALUES
('BY78324JH542OM723MNDF91234LK',4,2500),
('BY22344GF9021K0900MB62264GB1',1,5200),
('BY723KJ9873MN20001ZPL777MBV8',5,270000),
('BY4380H0512GBD345166M9113NC2',2,8440),
('BY0103T77530NX7425BCD66839L9',3,6200);

INSERT  INTO PAYMENT_TRANSACTION (CARD_NUMBER,ACCOUNT_ID,TRANSACTION_TYPE,MONEY_AMOUNT) VALUES
(4110559275236328,3,'DEPOSIT',4300),
(5431230964501124,4,'WITHDRAW',350),
(4110559275236328,3,'DEPOSIT',2670),
(5343678223196505,1,'DEPOSIT',900),
(4545900922113377,5,'WITHDRAW',800),
(4545900922113377,5,'WITHDRAW',420.5),
(4567124598526401,2,'DEPOSIT',450);




